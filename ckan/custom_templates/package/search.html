{% extends "page.html" %}
{% import 'macros/form.html' as form %}

{% block subtitle %}{{ _("Search for a Dataset") }}{% endblock %}

{% block add_action_content %}
  {% if h.check_access('package_create') %}
    {% link_for _('Add Dataset'), controller='package', action='new', class_='btn btn-primary', icon='plus-sign-alt' %}
  {% endif %}
{% endblock %}

{% block primary_content %}
  <section class="module">
    <div class="module-content">
      <form id="dataset-search" class="dataset-search clearfix" method="get" data-module="select-switch">
        <span class="control-group search-giant">
          <input type="text" class="search" name="q" value="{{ c.q }}" autocomplete="off" placeholder="{{ _('Search...') }}" />
          <button type="submit" value="search">{{ _('Submit') }}</button>
        </span>

        {{ h.snippet('snippets/sort_by.html', sort=c.sort_by_selected) }}

        {% if c.fields -%}
          <span>
            {{ form.hidden_from_list(fields=c.fields) }}
          </span>
        {%- endif %}

        <div id="dataset-search-ext">{% block dataset_search_ext %}{% endblock %}</div>
      </form>
      <div class="results">
        <strong>
          {% snippet 'snippets/search_result_text.html', query=c.q, count=c.page.item_count, type='dataset' %}
        </strong>
        <div class="filter-list">
          {% for field in c.fields_grouped %}
            {% set search_facets_items = c.search_facets.get(field)['items'] %}
            <span class="facet">{{ c.facet_titles.get(field) }}:</span>
            {% for value in c.fields_grouped[field] %}
              <span class="filtered pill">
                {%- if c.translated_fields and c.translated_fields.has_key((field,value)) -%}
                  {{ c.translated_fields[(field,value)] }}
                {%- else -%}
                  {{ h.list_dict_filter(search_facets_items , 'name', 'display_name', value) }}
                {%- endif %}
                <a href="{{ c.remove_field(field, value) }}" class="remove" title="{{ _('Remove') }}"><i class="icon-remove"></i></a>
              </span>
            {% endfor %}
          {% endfor %}
        </div>
        {% if request.params and c.page.item_count == 0 %}
          {% trans %}
            <p class="extra">Please try another search.</p>
          {% endtrans %}
        {% endif %}
      </div>

      {% if c.query_error %}
        {% trans %}
          <p><strong>There was an error while searching.</strong> Please try again.</p>
        {% endtrans %}
      {% endif %}
      {{ h.snippet('snippets/package_list.html', packages=c.page.items) }}
    </div>

    {{ c.page.pager(q=c.q) }}
  </section>

  <section class="module">
    <div class="module-content">
      <small>
        {% set api_link = h.link_to(_('API'), h.url_for(controller='api', action='get_api', ver=3)) %}
        {% set api_doc_link = h.link_to(_('API Docs'), 'http://docs.ckan.org/{0}/{1}/api.html'.format(request.environ.CKAN_LANG, g.ckan_doc_version)) %}
        {% if g.dumps_url -%}
          {% set dump_link = h.link_to(_('full {format} dump').format(format=g.dumps_format), g.dumps_url) %}
          {% trans %}
            You can also access this registry using the {{ api_link }} (see {{ api_doc_link }}) or download a {{ dump_link }}.
          {% endtrans %}
        {% else %}
          {% trans %}
            You can also access this registry using the {{ api_link }} (see {{ api_doc_link}}).
          {% endtrans %}
        {%- endif %}
      </small>
    </div>
  </section>
{% endblock %}

{% block secondary_content %}
  {% for facet in c.facet_titles %}
      {{ h.snippet('snippets/facet_list.html', title=c.facet_titles[facet], name=facet) }}
  {% endfor %}
{% endblock %}


<div class="primary-content">
  <div class="page--content-wrapper">
    <section class="page--content">
      <h1 class="page--title">{{ _('Find dataset') }}</h1>
    </section>
    <div class="search-form--content-block">
      <form action="/dataset" method="get">
        <label class="search-form--content-block--label">{{ _('Search in datasets') }}/label>
        <input name="q" type="text" placeholder="F.eks. parkering, bygninger eller lignende" class="search-form--content-block--input" />
        <input type="submit" class="search-form--content-block--button" value="Søg" />
      </form>
    </div>
    <div class="dataset--list-actions">
      {{ h.snippet('snippets/sort_by.html', sort=c.sort_by_selected) }}
   </div>
    <section class="dataset--list-wrapper">
      {{ h.snippet('snippets/package_list.html', packages=c.page.items) }}
      {{ c.page.pager(q=c.q) }}
      <!--<ul class="pager">
        <li class="pager-previous first">&nbsp;</li>
        <li class="pager-current">1</li>
        <li class="pager-item"><a href="#">2</a></li>
        <li class="pager-next last"><a href="#"><i class="icon-angle-right"></i></a></li>
      </ul>-->
    </section>
  </div>
</div>

{% block secondary_content %}
  {% for facet in c.facet_titles %}
      {{ h.snippet('snippets/facet_list.html', title=c.facet_titles[facet], name=facet) }}
  {% endfor %}
{% endblock %}
<div class="secondary-content">
  <div class="spotbox-menu">
    <div class="spotbox-menu--inner">
      <h3 class="spotbox-menu--header"><i class="icon-filter"></i>Tags</h3>
      <p class="spotbox-menu--list-remove-all"><a href="#"><i class="icon-remove"></i>Fjern alle</a></p>
      <ul class="spotbox-menu--list">
        <li class="spotbox-menu--list-item first"><a href="#" class="active"><i class="icon-check"></i>Aarhus Kommune (15)</a></li>
        <li class="spotbox-menu--list-item"><a href="#" class="active"><i class="icon-check"></i>Aarhus Kommune (10)</a></li>
        <li class="spotbox-menu--list-item"><a href="#"><i class="icon-check-empty"></i>vandværker (1)</a></li>
        <li class="spotbox-menu--list-item"><a href="#"><i class="icon-check-empty"></i>vandindvinding (1)</a></li>
        <li class="spotbox-menu--list-item"><a href="#"><i class="icon-check-empty"></i>toiletter (1)</a></li>
        <li class="spotbox-menu--list-item"><a href="#"><i class="icon-check-empty"></i>toilet (1)</a></li>
        <li class="spotbox-menu--list-item"><a href="#"><i class="icon-check-empty"></i>skove (1)</a></li>
        <li class="spotbox-menu--list-item"><a href="#"><i class="icon-check-empty"></i>parker (1)</a></li>
        <li class="spotbox-menu--list-item"><a href="#"><i class="icon-check-empty"></i>p-pladser (1)</a></li>
        <li class="spotbox-menu--list-item last"><a href="#"><i class="icon-check-empty"></i>p-pladser (1)</a></li>
      </ul>
      <p class="spotbox-menu--list-show-more"><a href="#">Vis flere tags</a></p>
    </div>
  </div>
  <div class="spotbox-menu">
    <div class="spotbox-menu--inner">
      <h3 class="spotbox-menu--header"><i class="icon-filter"></i>Formater</h3>
      <ul class="spotbox-menu--list">
        <li class="spotbox-menu--list-item first"><a href="#"><i class="icon-check-empty"></i>PDF (23)</a></li>
        <li class="spotbox-menu--list-item"><a href="#"><i class="icon-check-empty"></i>KML (17)</a></li>
        <li class="spotbox-menu--list-item"><a href="#"><i class="icon-check-empty"></i>xlsx (8)</a></li>
        <li class="spotbox-menu--list-item"><a href="#"><i class="icon-check-empty"></i>HTML (6)</a></li>
        <li class="spotbox-menu--list-item"><a href="#"><i class="icon-check-empty"></i>XML (5)</a></li>
        <li class="spotbox-menu--list-item"><a href="#"><i class="icon-check-empty"></i>CSV (3)</a></li>
        <li class="spotbox-menu--list-item"><a href="#"><i class="icon-check-empty"></i>dwg (2)</a></li>
        <li class="spotbox-menu--list-item"><a href="#"><i class="icon-check-empty"></i>docx (2)</a></li>
        <li class="spotbox-menu--list-item"><a href="#"><i class="icon-check-empty"></i>XLS (2)</a></li>
        <li class="spotbox-menu--list-item last"><a href="#"><i class="icon-check-empty"></i>TXT (2)</a></li>
      </ul>
      <p class="spotbox-menu--list-show-more"><a href="#">Vis flere formater</a></p>
    </div>
  </div>
  <div class="spotbox-menu">
    <div class="spotbox-menu--inner">
      <h3 class="spotbox-menu--header"><i class="icon-filter"></i>Grupper</h3>
      <ul class="spotbox-menu--list">
        <li class="spotbox-menu--list-item"><a href="#"><i class="icon-check-empty"></i>Aarhus Kommune (15)</a></li>
        <li class="spotbox-menu--list-item"><a href="#"><i class="icon-check-empty"></i>Aarhus Kommune (10)</a></li>
        <li class="spotbox-menu--list-item"><a href="#"><i class="icon-check-empty"></i>vandværker (1)</a></li>
        <li class="spotbox-menu--list-item"><a href="#"><i class="icon-check-empty"></i>vandindvinding (1)</a></li>
        <li class="spotbox-menu--list-item"><a href="#"><i class="icon-check-empty"></i>toiletter (1)</a></li>
        <li class="spotbox-menu--list-item"><a href="#"><i class="icon-check-empty"></i>toilet (1)</a></li>
        <li class="spotbox-menu--list-item"><a href="#"><i class="icon-check-empty"></i>skove (1)</a></li>
        <li class="spotbox-menu--list-item"><a href="#"><i class="icon-check-empty"></i>parker (1)</a></li>
        <li class="spotbox-menu--list-item"><a href="#"><i class="icon-check-empty"></i>p-pladser (1)</a></li>
        <li class="spotbox-menu--list-item last"><a href="#"><i class="icon-check-empty"></i>p-pladser (1)</a></li>
      </ul>
      <p class="spotbox-menu--list-show-more"><a href="#">Vis flere grupper</a></p>
    </div>
  </div>
</div>